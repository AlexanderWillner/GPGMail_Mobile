<!doctype HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<title>CAST-128 Encryption Test in JavaScript</title>
<script src="cast5.js" type="text/javascript" language="JavaScript"></script>

<script type="text/javascript" language="JavaScript"><!--

// This function takes an array of bytes (byteArray) and converts them
// to a hexadecimal string. Array element 0 is found at the beginning of 
// the resulting string, high nibble first. Consecutive elements follow
// similarly, for example [16, 255] --> "10ff". The function returns a 
// string.

function byteArrayToHex(byteArray) {
  var result = '';
  if (!byteArray)
    return;
  for (var i=0; i<byteArray.length; i++)
    result += ((byteArray[i]<16) ? "0" : "") + byteArray[i].toString(16);

  return result;
}

function hexTobyteArray(hex)
{

  if(hex.indexOf("0x") == 0 || hex.indexOf("0X") == 0) hex = hex.substr(2);

  if(hex.length%2) hex+='0';

  var r=new Array(hex.length/2);
  var j=0;

  for(var i = 0; i<hex.length; i += 2)
    r[j++] = parseInt(hex.slice(i, i+2), 16);
  return r;
}

function doEncryption()
{
  var pt = new Array()
  var key = new Array();
  var theForm = document.forms[0];
  blockSizeInBits=64;
  keySizeInBits = 128;

  if (theForm.key.value.toLowerCase().indexOf("0x") == 0)
    theForm.key.value = theForm.key.value.substring(2);
  if (theForm.plaintext.value.toLowerCase().indexOf("0x") == 0)
    theForm.plaintext.value = theForm.plaintext.value.substring(2);
  
  if (theForm.key.value.length*4 != keySizeInBits) {
    alert("For a " + keySizeInBits + " bit key, the hex string needs to be " +
          (keySizeInBits / 4) + " hex characters long."+theForm.key.value.length);
    if (theForm.key.select)
       theForm.key.select();
    return;
  }

  if ((theForm.plaintext.value.length*4)%blockSizeInBits != 0)
  {
    alert("For a " + blockSizeInBits + " bit block, the hex plaintext string needs to be a multiple of" +
          (blockSizeInBits / 4) + " hex characters long.");
    if (theForm.plaintext.select)
       theForm.plaintext.select();
    return;
  }

  pt = hexTobyteArray(theForm.plaintext.value);
  key = hexTobyteArray(theForm.key.value);

  var c5 = new cast5(key);

  theForm.ciphertext.value = byteArrayToHex(c5.Encrypt(pt));
}

function doDecryption() {
  var ct = new Array();
  var key = new Array();
  var theForm = document.forms[0];
  blockSizeInBits=64;
  keySizeInBits = 128;

  if (theForm.key.value.toLowerCase().indexOf("0x") == 0)
    theForm.key.value = theForm.key.value.substring(2);
  if (theForm.ciphertext.value.toLowerCase().indexOf("0x") == 0)
    theForm.ciphertext.value = theForm.ciphertext.value.substring(2);
  
  if (theForm.key.value.length*4 != keySizeInBits) {
    alert("For a " + keySizeInBits + " bit key, the hex string needs to be " +
          (keySizeInBits / 4) + " hex characters long.");
    if (theForm.key.select)
       theForm.key.select();
    return;
  }

  if ((theForm.ciphertext.value.length*4)%blockSizeInBits != 0)
  {
    alert("For a " + blockSizeInBits + " bit block, the hex ciphertext string needs to be a multiple of" +
          (blockSizeInBits / 4) + " hex characters long.");
    if (theForm.plaintext.select)
       theForm.plaintext.select();
    return;
  }
     
     
  ct = hexTobyteArray(theForm.ciphertext.value);
  key = hexTobyteArray(theForm.key.value);

  var c5 = new cast5(key);

  theForm.plaintext.value = byteArrayToHex(c5.Decrypt(ct));

}
// --></script>
</head>

<body>
<h2 align=center>CAST-128 Encryption Test in JavaScript</h2>
<center><font size="-1">2011 Herbert Hanewinkel</font></center>
<hr>
<center>[<a href="cast5.htm">Description</a>] [Test]</center>

<p>
<form name="cast5test">
<table>

<tr>
<td><b>Key in hex: </b></td>
<td><input type="text" size="66" name="key"></td></tr>
<tr><td><b>Plaintext in hex: </b></td>
<td><input type="text" size="66" name="plaintext"></td>
</tr>

<tr>
<td><b>Ciphertext in hex: </b></td>
<td><input type="text" size="66" name="ciphertext"></td>
</tr>

<tr>
<td>&nbsp;</td>
<td>
<input type="button" value="Encrypt" onclick="doEncryption()"> &nbsp; &nbsp; 
<input type="button" value="Decrypt" onclick="doDecryption()"> &nbsp; &nbsp; 
<input type="reset" value="Clear"></td>
</tr>
</table>
</form>
</p>

<table>
<tr><td>Key (128):</td><td><tt>0123456712345678234567893456789A</tt></td></tr>
<tr><td>Plaintext:</td><td><tt>0123456789ABCDEF</tt></td></tr>
<tr><td>Ciphertext:</td><td><tt>238B4FE5847E44B2</tt></td></tr>
<tr><td></td></tr>

<tr><td>Key (128):</td><td><tt>E8E9EAEBEDEEEFF0F2F3F4F5F7F8F9FA</tt></td></tr>
<tr><td>Plaintext:</td><td><tt>014BAF2278A69D331D5180103643E99A</tt></td></tr>
<tr><td>Ciphertext:</td><td><tt>6FA43AB7E89D77A8B860BF10F709CA4E</tt></td></tr>
</table>

<hr align=center width="99%">
<table width="100%"><tr>
<td>
<font size="-1"><i>www.hanewin.de</i></font>
</td>
<td align=right><font size="-1"><i>
<a href="http://www.hanewin.de/homee.htm" target="_top">Home</a>
</i></font></td>
</tr></table>
</body>
</html>
